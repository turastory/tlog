{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/source-set-in-kotlin-gradle-dsl/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Turastory"}},"markdownRemark":{"id":"31f1bd98-0582-50af-aac3-e09f56a24524","excerpt":"Gradle에서는 모듈 내에서도 소스셋을 나누어 사용할 수 있다. Intellij를 사용했을 때는 기본적으로는 다음과 같이 ,  두 가지의 source set…","html":"<p>Gradle에서는 모듈 내에서도 소스셋을 나누어 사용할 수 있다. Intellij를 사용했을 때는 기본적으로는 다음과 같이 <code class=\"language-text\">main</code>, <code class=\"language-text\">test</code> 두 가지의 source set이 디폴트로 주어지지만, 상황에 따라 여분의 소스셋을 추가하고 싶을 때도 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 296px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3887c410a71dde00686efefc185d78b5/b1a44/main-and-test.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 106.32911392405065%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAADiUlEQVQ4y32TSW8bRxCF+TtyCpCccsjFkLjMvg855AxnuIkUSYmiSIqirN3W5lgK4izwJTF8CRDkmr/5Bd0CtZnJ4U119XS/6tf1OqfbLs1Ol6Kmc3h9x49//Ena6TEa7zLaneD4IUXNQDGsB5R081n+FDnx0SxHbqqkTdpbY7xKlVqSEtUzREHxT5AUVP2B7L9Ic+LHErrlUFBUrKBMszfAsyw5J0gNx8ULK6im/QXpU/LcciCq1+oZThASZy3u/voH6+Yjh8cnvLm45N37W37+9Tc6vU3yiiaJ//eEIhHSCpqBbpiU4hbfzK4wbBfNsHDDCpYXyHXriiZJ86r+OFY0yZNbddGyiKKhF/LsHr1ha36I5YeE1RpRXCdOG1TrGVGSkrbaMm+0O5iO90j4jFRGm6JhsTi/4vT2FzqbQ45Pz9iZTBlPZ+ztH7A53GayN2f/9aHMLdd/TvjyokuGRd50KRQV2RzhhrWSSlE3pVRxRcsmCYj8C0Ixabo+SaNFUdX5+voTX13+Tq07oD8Y0u0PpT8FLM8nqEQkWQPbC6QLVp5QtRzZgJJm8F1nh28HC/wko7vZJ2t1JFobPSlRWEqY3w3KEqsJTVtKFOM4SQnDKgXVYK2osF5SZXxVKEmrCUV5RZddLmoruryULE4hnuP1x8/8cHvGZjdj7+CIhWjA4kDG8WTGaDyRXt2d7q324fLdrpcUefG6W2GQFYlCFd0JCaIqQVSjXIulNwWCShWvHD1/KYJUTAov+bU6s+NzkjghihO8KCFKGlRqiZQspOZVjYJ2L1nk8p0bJrmSZiJQUHSCSoxhe0S1lLNPf7N2+5npbM7VzQ03796zNRqTL+kouiVR0iyW+5fImWWXe3jogY0eOlihQ7EW8f3ODLPiYQeB/K8FFppvyTUiGqEj5x85XHJ+u8wSQbuC1wqJejEbu13CxML7YGLdqXTmXbYXOwwX20xP9pgcz4h6Nbn+KUfOa4a8RNiOiPsZbrOMfaRjXii0pm1mx3O29keSeHw4kYXdRojfKkuIvSsJ/VblYUE67BN12lhpgJnYmHUXM3EwYhs783AaPnbqYWf+PeGS/WkVUbk7GxBkPlc/nXP54ZjRvMvi7RGvL444eHso4+x0LuUfXZ3IsZTspgEv4TfK+M2IcuIz6K8zXagMhiH1wQadUZfW9gYbOz2yQYt00KSz06O51cHLQv4Fgl0Ungq26OcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"main and test source sets\"\n        title=\"main and test source sets\"\n        src=\"/static/3887c410a71dde00686efefc185d78b5/b1a44/main-and-test.png\"\n        srcset=\"/static/3887c410a71dde00686efefc185d78b5/c26ae/main-and-test.png 158w,\n/static/3887c410a71dde00686efefc185d78b5/b1a44/main-and-test.png 296w\"\n        sizes=\"(max-width: 296px) 100vw, 296px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>나는 유닛 테스트와 통합 테스트를 서로 다른 소스셋으로 구분하고 싶어서 기존의 <code class=\"language-text\">test</code>는 그대로 둔 채로 <code class=\"language-text\">integrationTest</code>라는 소스셋을 새로 추가했다. <code class=\"language-text\">build.gradle.kts</code>에서 아래와 같이 새로운 소스셋을 추가할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// Create a new sourceSet for integration tests</span>\nsourceSets <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"integrationTest\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        java <span class=\"token punctuation\">{</span>\n            compileClasspath <span class=\"token operator\">+=</span> main<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>output <span class=\"token operator\">+</span> test<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>output\n            runtimeClasspath <span class=\"token operator\">+=</span> main<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>output <span class=\"token operator\">+</span> test<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>output\n            <span class=\"token function\">srcDir</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"src/integrationTest/kotlin\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">val</span> integrationTestImplementation <span class=\"token keyword\">by</span> configurations<span class=\"token punctuation\">.</span><span class=\"token function\">getting</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">extendsFrom</span><span class=\"token punctuation\">(</span>configurations<span class=\"token punctuation\">.</span>testImplementation<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nconfigurations<span class=\"token punctuation\">[</span><span class=\"token string\">\"integrationTestRuntimeOnly\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">extendsFrom</span><span class=\"token punctuation\">(</span>configurations<span class=\"token punctuation\">.</span>testRuntimeOnly<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>여기서 주목할 만한 부분은 <code class=\"language-text\">classpath</code>를 설정하는 부분이다. 기존에 테스트를 작성할 때는 별도의 설정 없이 <code class=\"language-text\">main</code> 소스셋의 클래스들을 가져다 사용할 수 있었다. 이는 <code class=\"language-text\">test</code> 소스셋에서 <code class=\"language-text\">main</code>의 클래스패스를 참조하기 때문에 그렇다. 마찬가지로 <code class=\"language-text\">integrationTest</code>에서도 테스트를 위한 디펜던시들에 접근해야 하기 때문에 <code class=\"language-text\">test</code>의 빌드 결과를 새로운 소스셋의 클래스패스에 추가해주었다.</p>\n<p><a href=\"https://docs.gradle.org/current/dsl/org.gradle.api.tasks.SourceSetOutput.html\">공식 문서</a>에서 SourceSet의 output에 대한 설명을 찾을 수 있다.</p>\n<blockquote>\n<p>A collection of all output directories (compiled classes, processed resources, etc.) - notice that SourceSetOutput extends FileCollection.</p>\n</blockquote>\n<p>여기까지 작성했다면 IDE의 파일 트리에 새로운 소스셋이 추가된 것을 확인할 수 있다. 그런데 Intellij가 해당 소스셋을 테스트 소스셋으로 인식하지 않는다.</p>\n<p>이를 위해서는 idea 플러그인을 추가하고, <code class=\"language-text\">testSourceDirs</code>에 새로 추가한 소스셋을 등록하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\">plugins <span class=\"token punctuation\">{</span>\n    idea\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Register integrationTest sourceSet as a test sourceSet.</span>\nidea<span class=\"token punctuation\">.</span><span class=\"token function\">module</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> testSources <span class=\"token operator\">=</span> testSourceDirs\n    testSources<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>project<span class=\"token punctuation\">.</span>sourceSets<span class=\"token punctuation\">.</span><span class=\"token function\">getByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"integrationTest\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">.</span>srcDirs<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// This line is redundant, but I just keep it as a reference.</span>\n    testSources<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>project<span class=\"token punctuation\">.</span>sourceSets<span class=\"token punctuation\">.</span><span class=\"token function\">getByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"integrationTest\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>resources<span class=\"token punctuation\">.</span>srcDirs<span class=\"token punctuation\">)</span>\n    testSourceDirs <span class=\"token operator\">=</span> testSources\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 286px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a53c37a0a88681b319ec85f78714b5bc/357e3/test-source-set.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82.91139240506328%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAADF0lEQVQ4y4WUWU8bSRRG+++MNNIIJQEb416rN2946bbbC6GxAZtgNyYJtlkCgRAmIZqHeZmXmad5nD95Rl1gNEuUPBzdrqrvfnVburcU2yuQ0wy6ewd0Oj18z8MtlXGLJYkuHEzHxbBdvFKZzUaALmycQonedoxbLMszv1yRPkqlFrCWUzm7/pnmb3/hjGfcXl1xfDLj0+d7bj7c8u7yPecXl1xeXfPh9o7Tswtm81Oub25ZnJ7L/ZP5KdkNDSVn6qiOwLA0ftg74ll3B2GY6MJFcwW1VkipUUW1LXRXYPoOouihuzaG52D4DlbBk/upRnGbBezApRaHVGoOTk/HutIQI4sgblHp1WjETbrDLZqDCCf0EQ0XO/CeEMHDOj1TloJwEFGK6lixjfh1A/NcZZgccHI5Y3h8wHiWkMynbPZqiMAjLSTN/SepqbJ0Fg0Hq+6wrNis2XKdXpbGJWbdxnyK9lNly2oVJ3iosDlo47eKVOM2i7t7tsf7NLZDOsMtWrsdot0OYT+ivd+T39Fel2i3i9cqPpo9Vug0fezQoxGH2O1N4sji5KbCYlZg53CL8fyIyTxh9OYVk8WRjP1kl/FswuFsQrFTkfmpT4qiuhaaJySqa2LaGhvWc1w/Q85SyRh58raB7i81Fvqj/mso5WqDtfU8J9efSd59pNhoMTpI6Gz12d0fMT1+g+0VpWY9r0uyj/FrKMIrkFF1dnYGrNz/yWpyQTLcYzSecDhJmEyP8UoVMhsqOd2Q0/AtlGxeI6ebaJZNVnhkDMHKizV+evaCldUMz7M5pEYzWFf17xvWw5ZMOLv7haObLwRbMa/fvuUwOWK2OCNotVldz7OhmU+m30JRLUFWM2hHHX78+Dsrwzn9qEsvHtDf25cPQvq7y4TvVmhVHUTNxShbGFUfo+mQj1TyJQOtZGFUBE7Dxw9LOHWfpd6qujL+F9mH6Sx2Ry+pd0PEwEL8kcN6r3IwPSQ5ncreSxZTSblblXrZd+H/UZYjIzfSbm+72K8Eoi+ovwzlo1CPQ4KdlsSPSg/6wP/XA7Ecvb8BbdySfdz8gzUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"recognize as test source set\"\n        title=\"recognize as test source set\"\n        src=\"/static/a53c37a0a88681b319ec85f78714b5bc/357e3/test-source-set.png\"\n        srcset=\"/static/a53c37a0a88681b319ec85f78714b5bc/c26ae/test-source-set.png 158w,\n/static/a53c37a0a88681b319ec85f78714b5bc/357e3/test-source-set.png 286w\"\n        sizes=\"(max-width: 286px) 100vw, 286px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>마지막으로 해결해야 하는 문제는 새로 만든 소스셋에서 main이 아닌 다른 소스셋(가령 test)의 코드를 가져다쓸 수 있게 하는 것이다. 지금 이대로 사용할 경우 유닛 테스트에서 만든 테스트 데이터를 <code class=\"language-text\">integrationTest</code> 소스셋에서는 사용할 수 없다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">task(\"integrationTest\", Test::class) {\n    testClassesDirs = sourceSets[\"integrationTest\"].output\n    classpath = sourceSets[\"integrationTest\"].runtimeClasspath\n}\n\n\nval integrationTestImplementation: Configuration by configurations.getting {\n    extendsFrom(configurations.testImplementation.get())\n}\n\nconfigurations {\n    getByName(\"integrationTestRuntimeOnly\") {\n        extendsFrom(configurations.testRuntimeOnly.get())\n    }\n}</code></pre></div>\n<h3>References</h3>\n<ul>\n<li><a href=\"https://docs.gradle.org/current/userguide/java_testing.html#sec:configuring_java_integration_tests\">https://docs.gradle.org/current/userguide/java_testing.html#sec:configuring_java_integration_tests</a></li>\n<li><a href=\"https://rio-kim.github.io/testing/2017/12/20/gradle_test_sourceset_config/\">https://rio-kim.github.io/testing/2017/12/20/gradle_test_sourceset_config/</a></li>\n</ul>","frontmatter":{"title":"Gradle 프로젝트에 새로운 Source Set 추가하기 (with Kotlin Gradle DSL)","date":"February 27, 2022","description":"용도에 따라 소스를 분리해서 관리하고 싶다면!","tags":["kotlin","gradle","intellij"]}},"previous":{"fields":{"slug":"/snippets/kubeconfig/"},"frontmatter":{"title":"kubeconfig 정리"}},"next":{"fields":{"slug":"/snippets/pandas-cheatsheet/"},"frontmatter":{"title":"Pandas Cheatsheet"}}},"pageContext":{"id":"31f1bd98-0582-50af-aac3-e09f56a24524","previousPostId":"3027bfb9-fd38-5016-8a27-06a24a5952a5","nextPostId":"81efbda9-e98b-572b-ba7f-9724282c04e7"}},
    "staticQueryHashes": ["2841359383"]}