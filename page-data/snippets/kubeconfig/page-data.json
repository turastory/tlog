{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/snippets/kubeconfig/","result":{"data":{"site":{"siteMetadata":{"title":"Alan'space"}},"markdownRemark":{"id":"47848a05-00da-5a1f-bcf0-f5a99487180b","fields":{"slug":"/snippets/kubeconfig/"},"excerpt":"GitHub Actions를 사용해 배포 스크립트를 작성하다가 kubeconfig 파일에 관한 부분이 헷갈려 정리해보았다. What is…","html":"<p>GitHub Actions를 사용해 배포 스크립트를 작성하다가 kubeconfig 파일에 관한 부분이 헷갈려 정리해보았다.</p>\n<h3>What is kubeconfig</h3>\n<p>kubeconfig 파일은 클러스터, 유저, 네임스페이스, 인증 등 *<em>클러스터 접근</em>에 대한 정보를 담고 있는 파일이다.</p>\n<h3>Where is it</h3>\n<p>기본적으로는 <code class=\"language-text\">$HOME/.kube/config</code>에 위치한다. 명령을 실행할 때는 디폴트로 이 파일을 사용하고, <code class=\"language-text\">KUBECONFIG</code> 환경 변수를 사용하거나 <code class=\"language-text\">--kubeconfig</code> 플래그를 사용해 직접 명시할 수 있다.</p>\n<h3>How to use it (in deployment)</h3>\n<p>GitHub Actions를 이용해서 쿠버네티스에 배포를 하려면 마찬가지로 클러스터에 대한 접속 정보가 필요하기 때문에 이를 위해서 kubeconfig를 사용한다. 어떤 액션을 사용하는지는 자유겠지만, 나는 <a href=\"https://github.com/Azure/k8s-set-context\">k8s-set-context</a>라는 액션을 사용하기로 했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/220f47b321f97f4769bc00cd5375bb2f/bf286/k8s-set-context.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.58227848101266%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAxUlEQVR42pWQWwrCMBBFuwCVKrZq3o82SW19V/wQ3f+urjGgKMUPPw73ThgOQzLrt6jCDq7dw7cHyGqN8bTEKC8xmS3/JiuoAg8NmN1AuH3MDjIcwOstCqJRUpMoiHn3X8xXCtmCGfjrCe7cI/R3hOMNen2C9DsseTVgwT67HQrzgoEGB7FpoLsetrtAtz1kvJAoDxpZiTol0yF1Il2Cm+ZLmoTSNlC2BY/LVFRgso49ip5pAlgUPWcR98RrVi695XMy+MMH1LuHLfRc3zEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"k8s-set-context\"\n        title=\"\"\n        src=\"/static/220f47b321f97f4769bc00cd5375bb2f/f058b/k8s-set-context.png\"\n        srcset=\"/static/220f47b321f97f4769bc00cd5375bb2f/c26ae/k8s-set-context.png 158w,\n/static/220f47b321f97f4769bc00cd5375bb2f/6bdcf/k8s-set-context.png 315w,\n/static/220f47b321f97f4769bc00cd5375bb2f/f058b/k8s-set-context.png 630w,\n/static/220f47b321f97f4769bc00cd5375bb2f/40601/k8s-set-context.png 945w,\n/static/220f47b321f97f4769bc00cd5375bb2f/78612/k8s-set-context.png 1260w,\n/static/220f47b321f97f4769bc00cd5375bb2f/bf286/k8s-set-context.png 1688w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>문서를 보면 kubeconfig 파일의 <strong>내용</strong>이 들어가야 한다고 적혀있다. 그런데, 이게 Azure의 쿠버네티스 클러스터 서비스인 AKS 내용만 있어서 구체적으로 어떤 내용이 들어가야 하는지 몰랐다.</p>\n<p>방법은 사실 허탈할 정도로 간단하다. 다음과 같이 kubeconfig 파일의 내용을 복사한 다음, GitHub 설정에 secret으로 등록하고 사용하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cat ~/.kube/config | pbcopy</code></pre></div>\n<p>경우에 따라 base64 인코딩이 필요하기도 한데, 이럴 때는 쉘에 base64 유틸이 내장되어 있으니 이를 사용하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cat ~/.kube/config | base64 | pbcopy</code></pre></div>","frontmatter":{"date":"2022-02-16","title":"kubeconfig 정리","description":"뭐하는 녀석이냐!","category":"snippets","tags":["kubernetes","k8s","kubeconfig"]}},"previous":{"fields":{"slug":"/snippets/useful-git-recipes/"},"frontmatter":{"title":"유용한 Git 레시피 몇 가지"}},"next":{"fields":{"slug":"/snippets/pandas-cheatsheet/"},"frontmatter":{"title":"Pandas Cheatsheet"}}},"pageContext":{"id":"47848a05-00da-5a1f-bcf0-f5a99487180b","category":"snippets","tags":["kubernetes","k8s","kubeconfig"],"previousPostId":"9f4ddf13-061b-5caa-910e-54e0aab4df80","nextPostId":"7fe66fb2-b94b-537e-843d-2b363b92aaee"}},"staticQueryHashes":["2447914076"],"slicesMap":{}}